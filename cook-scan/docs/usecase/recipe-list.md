# ãƒ¬ã‚·ãƒ”ä¸€è¦§

## æ¦‚è¦

èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¿å­˜æ¸ˆã¿ã®ãƒ¬ã‚·ãƒ”ã‚’ã‚°ãƒªãƒƒãƒ‰å½¢å¼ã§ä¸€è¦§è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã€‚ãƒ¬ã‚·ãƒ”åã«ã‚ˆã‚‹æ¤œç´¢ã¨ã‚¿ã‚°ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ç®¡ç†ã—ã€Server Componentã§ã‚µãƒ¼ãƒãƒ¼å´ã«ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã€‚

## æ©Ÿèƒ½ä»•æ§˜

### ç›®çš„

- ä¿å­˜æ¸ˆã¿ãƒ¬ã‚·ãƒ”ã‚’ä¸€è¦§ã§ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
- ãƒ¬ã‚·ãƒ”åã®éƒ¨åˆ†ä¸€è‡´æ¤œç´¢ã§ãƒ¬ã‚·ãƒ”ã‚’ç´ æ—©ãè¦‹ã¤ã‘ã‚‹
- ã‚¿ã‚°ã‚’è¤‡æ•°é¸æŠã—ã¦ANDæ¡ä»¶ã§ãƒ¬ã‚·ãƒ”ã‚’çµã‚Šè¾¼ã‚€
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ã‚¤ãƒãƒ¼ãŒã‚ã‚‹ãƒ¬ã‚·ãƒ”ã‚’ãƒãƒŠãƒ¼ã§é€šçŸ¥ã™ã‚‹

### æ©Ÿèƒ½è©³ç´°

#### ãƒ¬ã‚·ãƒ”ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º
- 3ã‚«ãƒ©ãƒ ã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§ãƒ¬ã‚·ãƒ”ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
- å„ã‚«ãƒ¼ãƒ‰ã«è¡¨ç¤ºã™ã‚‹æƒ…å ±ï¼š
  - ãƒ¬ã‚·ãƒ”ç”»åƒï¼ˆ`imageUrl`ãŒã‚ã‚‹å ´åˆã®ã¿ã€‚ãƒ›ãƒãƒ¼ã§1.05å€ã‚¹ã‚±ãƒ¼ãƒ«ã€ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰
  - ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆãƒ›ãƒãƒ¼ã§ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰è‰²ã«å¤‰åŒ–ï¼‰
  - ææ–™æ•°ï¼ˆã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ + æ•°å­— + "å“ç›®"ï¼‰
  - ã‚¿ã‚°ï¼ˆæœ€å¤§3å€‹è¡¨ç¤ºã€4å€‹ä»¥ä¸Šã¯"+N"ã¨è¡¨ç¤ºã€ã‚¢ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼èƒŒæ™¯ï¼‰
  - ä½œæˆæ—¥ï¼ˆæ—¥æœ¬èªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: "YYYYå¹´MæœˆDæ—¥"ã€ã‚¯ãƒ­ãƒƒã‚¯ã‚¢ã‚¤ã‚³ãƒ³ä»˜ãï¼‰
- ã‚«ãƒ¼ãƒ‰å…¨ä½“ãŒãƒ¬ã‚·ãƒ”è©³ç´°ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ï¼ˆ`/recipes/[id]`ï¼‰

#### çµ±è¨ˆãƒãƒ¼
- ä¿å­˜ãƒ¬ã‚·ãƒ”æ•°ã®è¡¨ç¤ºï¼ˆ"ğŸ“– ä¿å­˜ãƒ¬ã‚·ãƒ”æ•°: {count}"ï¼‰
- "ãƒ¬ã‚·ãƒ”ã‚’ã‚¹ã‚­ãƒ£ãƒ³"ãƒœã‚¿ãƒ³ï¼ˆ`/recipes/new`ã¸ã®ãƒªãƒ³ã‚¯ï¼‰

#### ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ã‚¤ãƒãƒ¼ãƒãƒŠãƒ¼
- ã‚¿ã‚¤ãƒãƒ¼ãŒèµ·å‹•ä¸­ã®ãƒ¬ã‚·ãƒ”ãŒã‚ã‚‹å ´åˆã«ã®ã¿è¡¨ç¤º
- å¯¾è±¡ãƒ¬ã‚·ãƒ”ã¸ã®ç›´æ¥ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º

#### æ¤œç´¢æ©Ÿèƒ½
- URLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ `?q=æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰` ã§ç®¡ç†
- ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ã®éƒ¨åˆ†ä¸€è‡´ãƒ»å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ãªã—ï¼ˆ`mode: 'insensitive'`ï¼‰
- å‰å¾Œã®ç©ºç™½ã‚’ãƒˆãƒªãƒ 
- ç©ºæ–‡å­—åˆ—ã§ã¯æ¤œç´¢ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–
- Enterã‚­ãƒ¼ã¾ãŸã¯æ¤œç´¢ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å®Ÿè¡Œ
- ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã§æ¤œç´¢ã‚’ãƒªã‚»ãƒƒãƒˆ
- ä»–ã®URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿æŒã—ãŸã¾ã¾æ¤œç´¢ã‚’æ›´æ–°
- æ¤œç´¢çµæœä»¶æ•°ã‚’è¡¨ç¤º

#### ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- URLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ `?tag=id1&tag=id2` ã§ç®¡ç†ï¼ˆè¤‡æ•°é¸æŠï¼‰
- ã‚¿ã‚°ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦è¡¨ç¤º
- è¤‡æ•°ã‚¿ã‚°ã®åŒæ™‚é¸æŠå¯èƒ½ï¼ˆANDæ¡ä»¶ï¼‰
- é¸æŠçŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã¨èƒŒæ™¯è‰²ã§è¦–è¦šçš„ã«è¡¨ç¤º
- "ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¯ãƒªã‚¢"ãƒœã‚¿ãƒ³ã§å…¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è§£é™¤
- ã‚¿ã‚°ãŒå­˜åœ¨ã—ãªã„ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¯éè¡¨ç¤º
- é¸æŠä¸­ã®ã‚¿ã‚°æ•°ã‚’è¡¨ç¤º

#### ç©ºçŠ¶æ…‹ã®è¡¨ç¤º
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãªã—ã®å ´åˆ: "ãƒ¬ã‚·ãƒ”ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“" + "ãƒ¬ã‚·ãƒ”ã‚’ã‚¹ã‚­ãƒ£ãƒ³"ãƒœã‚¿ãƒ³
- æ¤œç´¢ã‚¯ã‚¨ãƒªã®ã¿ã®å ´åˆ: æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ã‚¿ã‚°ã®ã¿ã®å ´åˆ: ã‚¿ã‚°é¸æŠã«é–¢ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- æ¤œç´¢ï¼‹ã‚¿ã‚°ã®å ´åˆ: ä¸¡æ–¹ã®æ¡ä»¶ã‚’å«ã‚€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- æ¡ä»¶ãŒã‚ã‚‹å ´åˆã¯"ã™ã¹ã¦ã‚¯ãƒªã‚¢"ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º

#### UI/UX
- URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ç®¡ç†ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®æˆ»ã‚‹/é€²ã‚€å¯¾å¿œã€URLå…±æœ‰å¯èƒ½ï¼‰
- ãƒšãƒ¼ã‚¸å…¨ä½“ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯ `loading.tsx` + `PageLoading` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `RecipeSearch` ã¨ `TagFilter` ã¯å€‹åˆ¥ã«Suspenseã§ãƒ©ãƒƒãƒ—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ `null`ï¼‰

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼

```
1. /recipes ã«ã‚¢ã‚¯ã‚»ã‚¹
   â†“
2. Server ComponentãŒãƒ¬ã‚·ãƒ”ä¸€è¦§ã¨ã‚¿ã‚°ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’ä¸¦åˆ—å–å¾—
   â†“
3. ãƒ¬ã‚·ãƒ”ä¸€è¦§ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼ˆã‚°ãƒªãƒƒãƒ‰ + çµ±è¨ˆãƒãƒ¼ + æ¤œç´¢ + ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼‰
   â†“
4a. ãƒ¬ã‚·ãƒ”åã‚’å…¥åŠ›ã—ã¦æ¤œç´¢
    URLã« ?q= ã‚’è¿½åŠ  â†’ Server ComponentãŒå†ãƒ•ã‚§ãƒƒãƒ â†’ ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨ã•ã‚ŒãŸä¸€è¦§è¡¨ç¤º
   â†“
4b. ã‚¿ã‚°ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    URLã« ?tag= ã‚’è¿½åŠ  â†’ Server ComponentãŒå†ãƒ•ã‚§ãƒƒãƒ â†’ ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨ã•ã‚ŒãŸä¸€è¦§è¡¨ç¤º
   â†“
5. ãƒ¬ã‚·ãƒ”ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ /recipes/[id] ã¸é·ç§»
```

## ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

```mermaid
sequenceDiagram
    actor User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant Page as RecipesPage<br/>(Server Component)
    participant SA as Server Actions<br/>(actions.ts)
    participant Service as RecipeService / TagService
    participant DB as PostgreSQL<br/>(Prisma)
    participant UI as RecipeListContent<br/>(Client Component)

    User->>Page: /recipes ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆsearchParamsä»˜ãï¼‰

    Page->>Page: checkUserProfile() èªè¨¼ãƒã‚§ãƒƒã‚¯
    Page->>Page: parseRecipeSearchParams() URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è§£æ

    alt æœªèªè¨¼ã¾ãŸã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æœªè¨­å®š
        Page-->>User: nullï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå±¤ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰
    else èªè¨¼æ¸ˆã¿
        par ä¸¦åˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—
            Page->>SA: getRecipesWithFilters(searchQuery, tagIds)
            SA->>SA: withAuth() èªè¨¼ãƒã‚§ãƒƒã‚¯
            SA->>SA: buildTagFilters() Prisma WHEREå¥æ§‹ç¯‰
            SA->>Service: RecipeService.getRecipes(userId, searchQuery, tagFilters)
            Service->>DB: prisma.recipe.findMany(where, include, orderBy)
            DB-->>Service: RecipeListOutput[]
            Service-->>SA: RecipeListOutput[]
            SA-->>Page: Result<RecipeListOutput[]>
        and
            Page->>SA: getTagCategoriesForUser()
            SA->>SA: withAuth() èªè¨¼ãƒã‚§ãƒƒã‚¯
            SA->>Service: TagService.getAllTagsForRecipe(userId)
            Service->>DB: prisma.tagCategory.findMany(where, include)
            DB-->>Service: TagsForRecipeOutput
            Service-->>SA: TagsForRecipeOutput
            SA-->>Page: Result<TagsForRecipeOutput>
        end

        Page->>Page: isSuccess() ã§ã‚¨ãƒ©ãƒ¼æ™‚ã¯ç©ºé…åˆ—ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        Page->>UI: recipes, tagCategories, selectedTagIds, searchQuery ã‚’æ¸¡ã™
        UI-->>User: ãƒ¬ã‚·ãƒ”ä¸€è¦§ãƒšãƒ¼ã‚¸è¡¨ç¤º
    end

    User->>UI: æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å…¥åŠ› / ã‚¿ã‚°é¸æŠ
    UI->>Page: URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ›´æ–°ï¼ˆ?q= / ?tag=ï¼‰
    Note over Page,DB: ä¸Šè¨˜ã®ãƒ•ãƒ­ãƒ¼ã‚’å†å®Ÿè¡Œ
```

## æŠ€è¡“ä»•æ§˜

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/(auth)/recipes/page.tsx`
- **ã‚¿ã‚¤ãƒ—**: Server Componentï¼ˆasyncï¼‰
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: Tailwind CSS v4

#### ä½¿ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | ã‚¿ã‚¤ãƒ— | ç”¨é€” |
|---|---|---|---|
| `RecipeListContent` | `src/features/recipes/list/recipe-list-content.tsx` | Client Component | ä¸€è¦§ã‚³ãƒ³ãƒ†ãƒŠï¼ˆSuspenseãƒ©ãƒƒãƒ—ï¼‰ |
| `RecipeGrid` | `src/features/recipes/list/recipe-grid.tsx` | Client Component | ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º |
| `RecipeSearch` | `src/features/recipes/list/recipe-search.tsx` | Client Component | æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  |
| `TagFilter` | `src/features/recipes/list/tag-filter.tsx` | Client Component | ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ |
| `RecipeStatsBar` | `src/features/recipes/list/recipe-stats-bar.tsx` | Client Component | çµ±è¨ˆãƒãƒ¼ |
| `RecipeEmptyState` | `src/features/recipes/list/recipe-empty-state.tsx` | Client Component | ç©ºçŠ¶æ…‹è¡¨ç¤º |
| `ActiveTimerBanner` | `src/features/recipes/list/active-timer-banner.tsx` | Client Component | ã‚¿ã‚¤ãƒãƒ¼ãƒãƒŠãƒ¼ |
| `AuthLayoutWrapper` | `src/components/layouts/auth-layout-wrapper.tsx` | - | èªè¨¼æ¸ˆã¿ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ |
| `PageContainer` | `src/components/layouts/page-container.tsx` | - | ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠ |
| `BackToDashboardLink` | `src/components/navigation/back-to-dashboard-link.tsx` | - | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ |
| `PageLoading` | - | - | ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆloading.tsxï¼‰ |

#### URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç†
```typescript
type SearchParams = Promise<{ tag?: string | string[]; q?: string }>
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

#### Server Actions
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/features/recipes/list/actions.ts`
- **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–**: `'use server'`

| é–¢æ•°å | ã‚·ã‚°ãƒãƒãƒ£ | æ¦‚è¦ |
|---|---|---|
| `getRecipesWithFilters` | `(searchQuery: string, tagIds: string[]) => Promise<Result<RecipeListOutput[]>>` | ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶ä»˜ããƒ¬ã‚·ãƒ”å–å¾— |
| `getTagCategoriesForUser` | `() => Promise<Result<TagsForRecipeOutput>>` | ã‚¿ã‚°ã‚«ãƒ†ã‚´ãƒªãƒ¼å–å¾— |

#### ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/features/recipes/list/utils.ts`

| é–¢æ•°å | ã‚·ã‚°ãƒãƒãƒ£ | æ¦‚è¦ |
|---|---|---|
| `parseRecipeSearchParams` | `(searchParams) => { tagIds, searchQuery }` | URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è§£æ |
| `buildTagFilters` | `(tagIds: string[]) => Prisma.RecipeWhereInput[] \| undefined` | Prisma WHEREå¥ã®æ§‹ç¯‰ |

#### å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆgetRecipesWithFiltersï¼‰
1. `withAuth()` ã§èªè¨¼ãƒã‚§ãƒƒã‚¯ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
2. `buildTagFilters()` ã§ã‚¿ã‚°IDã‚’Prisma `AND` æ¡ä»¶ã«å¤‰æ›
3. `RecipeService.getRecipes()` ã§ãƒ¬ã‚·ãƒ”å–å¾—
4. æˆåŠŸæ™‚: `success(recipes)` ã‚’è¿”ã™
5. ä¾‹å¤–æ™‚: `failure(Errors.server('ãƒ¬ã‚·ãƒ”ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ'))` ã‚’è¿”ã™

#### ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- `prisma` - ORMã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- `withAuth` (`src/utils/server-action`) - èªè¨¼ãƒ©ãƒƒãƒ‘ãƒ¼
- `Result` / `success` / `failure` / `Errors` (`src/utils/result`) - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Prismaã‚¯ã‚¨ãƒªè©³ç´°

#### ãƒ¬ã‚·ãƒ”å–å¾— (`findRecipesByUser`)
```typescript
prisma.recipe.findMany({
  where: {
    userId,
    ...(searchQuery && {
      title: { contains: searchQuery, mode: 'insensitive' },
    }),
    ...(tagFilters && { AND: tagFilters }),
  },
  include: {
    ingredients: true,
    recipeTags: {
      include: { tag: true },
    },
  },
  orderBy: { createdAt: 'desc' },
})
```

#### ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¯ã‚¨ãƒªæ§‹é€ 
```typescript
// tagIds = ['tag1', 'tag2'] ã®å ´åˆ
AND: [
  { recipeTags: { some: { tagId: 'tag1' } } },
  { recipeTags: { some: { tagId: 'tag2' } } },
]
// ä¸¡æ–¹ã®ã‚¿ã‚°ã‚’æŒã¤ãƒ¬ã‚·ãƒ”ã®ã¿ãŒè¿”ã•ã‚Œã‚‹ï¼ˆANDæ¡ä»¶ï¼‰
```

#### ã‚¿ã‚°ã‚«ãƒ†ã‚´ãƒªãƒ¼å–å¾— (`findTagCategoriesByUser`)
```typescript
prisma.tagCategory.findMany({
  where: {
    OR: [
      { isSystem: true },
      { userId },
    ],
  },
  include: {
    tags: { orderBy: { name: 'asc' } },
  },
  orderBy: { createdAt: 'asc' },
})
```

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### RecipeListOutput å‹ï¼ˆä¸€è¦§è¡¨ç¤ºç”¨ï¼‰

```typescript
type RecipeListOutput = {
  id: string
  title: string
  imageUrl: string | null
  createdAt: Date
  ingredients: Array<{ id: string; name: string; unit: string | null; notes: string | null; recipeId: string; createdAt: Date; updatedAt: Date }>
  recipeTags: Array<{
    tagId: string
    tag: {
      id: string
      name: string
    }
  }>
}
```

### é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«
- `recipes` - ãƒ¬ã‚·ãƒ”æœ¬ä½“
- `ingredients` - ææ–™ï¼ˆææ–™æ•°ã‚«ã‚¦ãƒ³ãƒˆã«ä½¿ç”¨ï¼‰
- `recipe_tags` - ãƒ¬ã‚·ãƒ”ã¨ã‚¿ã‚°ã®ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«
- `tags` - ã‚¿ã‚°
- `tag_categories` - ã‚¿ã‚°ã‚«ãƒ†ã‚´ãƒªãƒ¼

## APIä»•æ§˜

### getRecipesWithFilters (Server Action)

#### æ¦‚è¦
ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶ï¼ˆæ¤œç´¢ã‚¯ã‚¨ãƒªãƒ»ã‚¿ã‚°IDï¼‰ã«åŸºã¥ã„ã¦ã€èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¬ã‚·ãƒ”ä¸€è¦§ã‚’å–å¾—ã™ã‚‹ã€‚

#### ã‚·ã‚°ãƒãƒãƒ£
```typescript
async function getRecipesWithFilters(
  searchQuery: string,
  tagIds: string[]
): Promise<Result<RecipeListOutput[]>>
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
| åå‰ | å‹ | èª¬æ˜ |
|------|------|------|
| `searchQuery` | `string` | ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«ã®éƒ¨åˆ†ä¸€è‡´æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆç©ºæ–‡å­—åˆ—ã®å ´åˆã¯ãƒ•ã‚£ãƒ«ã‚¿ãªã—ï¼‰ |
| `tagIds` | `string[]` | ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ã‚¿ã‚°IDã®é…åˆ—ï¼ˆç©ºé…åˆ—ã®å ´åˆã¯ãƒ•ã‚£ãƒ«ã‚¿ãªã—ï¼‰ |

#### æˆ»ã‚Šå€¤
```typescript
// æˆåŠŸæ™‚
{ ok: true; data: RecipeListOutput[] }

// å¤±æ•—æ™‚
{ ok: false; error: AppError }
```

#### ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
| ã‚³ãƒ¼ãƒ‰ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ç™ºç”Ÿæ¡ä»¶ |
|--------|-----------|---------|
| `UNAUTHENTICATED` | - | æœªèªè¨¼ã¾ãŸã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æœªè¨­å®š |
| `SERVER_ERROR` | `'ãƒ¬ã‚·ãƒ”ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ'` | DBã‚¨ãƒ©ãƒ¼ãªã©äºˆæœŸã—ãªã„ä¾‹å¤– |

---

### getTagCategoriesForUser (Server Action)

#### æ¦‚è¦
èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ©ç”¨å¯èƒ½ãªã‚¿ã‚°ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆã‚·ã‚¹ãƒ†ãƒ å…±é€š + ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼‰ã¨ã‚¿ã‚°ã‚’å–å¾—ã™ã‚‹ã€‚

#### ã‚·ã‚°ãƒãƒãƒ£
```typescript
async function getTagCategoriesForUser(): Promise<Result<TagsForRecipeOutput>>
```

#### æˆ»ã‚Šå€¤
```typescript
// æˆåŠŸæ™‚
{ ok: true; data: TagsForRecipeOutput }

// å¤±æ•—æ™‚
{ ok: false; error: AppError }
```

#### ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
| ã‚³ãƒ¼ãƒ‰ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ç™ºç”Ÿæ¡ä»¶ |
|--------|-----------|---------|
| `UNAUTHENTICATED` | - | æœªèªè¨¼ã¾ãŸã¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æœªè¨­å®š |
| `SERVER_ERROR` | `'ã‚¿ã‚°ã‚«ãƒ†ã‚´ãƒªã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ'` | DBã‚¨ãƒ©ãƒ¼ãªã©äºˆæœŸã—ãªã„ä¾‹å¤– |

## ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Vitest + React Testing Library

| ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« | ãƒ†ã‚¹ãƒˆæ•° | ä¸»ãªãƒ†ã‚¹ãƒˆå†…å®¹ |
|---|---|---|
| `recipe-list-content.test.tsx` | 7 | ãƒ¬ã‚·ãƒ”/ç©ºçŠ¶æ…‹ã®è¡¨ç¤ºã€çµ±è¨ˆãƒãƒ¼ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ |
| `recipe-grid.test.tsx` | 11 | ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã€ãƒªãƒ³ã‚¯ã€ç”»åƒã€ææ–™æ•°ã€ã‚¿ã‚°ã€ä½œæˆæ—¥ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ |
| `recipe-search.test.tsx` | 19+ | åˆæœŸè¡¨ç¤ºã€æ¤œç´¢å…¥åŠ›ã€æ¤œç´¢å®Ÿè¡Œã€ã‚¯ãƒªã‚¢ã€çµæœã‚«ã‚¦ãƒ³ãƒˆã€URLåŒæœŸ |
| `tag-filter.test.tsx` | 10 | ã‚¿ã‚°è¡¨ç¤ºã€é¸æŠ/è§£é™¤ã€è¤‡æ•°é¸æŠã€ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã€ç©ºã‚«ãƒ†ã‚´ãƒªãƒ¼éè¡¨ç¤º |
| `recipe-empty-state.test.tsx` | 8 | ãƒ•ã‚£ãƒ«ã‚¿ãªã—/ã‚ã‚Š/æ¤œç´¢ã®ã¿/ã‚¿ã‚°ã®ã¿/ä¸¡æ–¹ã®ç©ºçŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| `recipe-stats-bar.test.tsx` | 8 | ãƒ¬ã‚·ãƒ”æ•°è¡¨ç¤ºï¼ˆ0/1/è¤‡æ•°ï¼‰ã€ã‚¹ã‚­ãƒ£ãƒ³ãƒœã‚¿ãƒ³ |
| `utils.test.ts` | 12+ | parseRecipeSearchParamsã€buildTagFilters |

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

1. **èªè¨¼ãƒã‚§ãƒƒã‚¯**
   - `checkUserProfile()` ã§ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«èªè¨¼ã‚’ç¢ºèª
   - `withAuth()` ãƒ©ãƒƒãƒ‘ãƒ¼ã§å„Server Actionã®èªè¨¼ã‚’çµ±ä¸€ç®¡ç†

2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰€æœ‰æ¨©ã®ç¢ºèª**
   - Prismaã‚¯ã‚¨ãƒªã« `userId` ã‚’å¿…ãšå«ã‚ã€ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã•ãªã„

3. **å…¥åŠ›å€¤ã®ç„¡å®³åŒ–**
   - æ¤œç´¢ã‚¯ã‚¨ãƒªã¯ `trim()` ã§å‰å¾Œã®ç©ºç™½ã‚’é™¤å»
   - Prismaã®Parameterized Queryã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–æ¸ˆã¿

## é…ç½®å ´æ‰€

ãƒ¬ã‚·ãƒ”ä¸€è¦§ãƒšãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®å ´æ‰€ã§ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã¾ã™ï¼š

1. **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**
   - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã‹ã‚‰ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯

2. **ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹**
   - `src/app/(auth)/recipes/page.tsx`
   - ãƒ‘ã‚¹: `/recipes`
   - èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼ˆ`(auth)` ãƒ«ãƒ¼ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
